{% extends "base.html" %}
{% block content %}
{% if request.session.islogin %}
<h1>您好 ,{{ request.session.nickname }}</h1>
{% else %}
<h1>Please login</h1>
{% endif %}
<div class="container">
<table border="1">
    <tr>
    <th>等待下单</th>
    <th>等待安排</th>
    <th>等待生产</th>
    <th>正在生产</th>
    <th>生产完成</th>
    <th>等待发货</th>
    <th>发货完成</th>
        <th>全部</th>
    </tr>
    {% if request.session.islogin %}
    <tr>
        <td><a href="/flow/status/1/">{{count.0}}</a></td>
        <td><a href="/flow/status/2/">{{count.1}}</a></td>
        <td><a href="/flow/status/3/">{{count.2}}</a></td>
        <td><a href="/flow/status/4/">{{count.3}}</a></td>
        <td><a href="/flow/status/5/">{{count.4}}</a></td>
        <td><a href="/flow/status/6/">{{count.5}}</a></td>
        <td><a href="/flow/status/7/">{{count.6}}</a></td>
        <td><a href="/flow/status/0/">全部</a></td>
    </tr>
    {% else %}
    <tr>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>全部</td>
    </tr>
    {% endif %}
</table>
<table border="1">
        <tr>
            <th>客户</th>
            <th>下单时间</th>
            <th>交货时间</th>
            <th>订单号</th>
            <th>产品规格</th>
            <th>数量</th>
            <th>订单状态</th>
            <th>当前负责人</th>
            <th>下一阶段负责人</th>
            <th>操作</th>
        </tr>
        <br>
        {% if request.session.islogin %}
        {% for i in results %}
        <tr>
            <td>{{i.client}}</td>
            <td>{{i.order_time}}</td>
            <td>{{i.sub_time}}</td>
            <td>{{i.order_num}}</td>
            <td>{{i.order_detail}}</td>
            <td>{{i.ps}}</td>
            <td>{{i.stat_nam}}</td>
            <td>{{i.person_incharge}}</td>
            <form action="{% url 'work_flow:update' i.uuid %}" method="POST">
                {% csrf_token %}
            <td>
                <select name="next_node">
                    {% for j in memb %}
                <option value="{{ j }}">{{ j }}</option>
                    {% endfor %}
            </select>
            </td>
            <td>
                <input type="submit" value="已完成">
            </form>
                <a href="/flow/delete/{{ i.uuid }}/"><button>删除</button></a>
                <a href="/flow/rollback/{{ i.uuid }}"><button>回退</button></a>
            </td>

        </tr>
        {% endfor %}
        {% endif %}
    <form action="{% url 'work_flow:add_order' %}" method="post">
        {% csrf_token %}
        <tr>
            <td>{{form.client}}</td>
            <td>{{form.order_time}}</td>
            <td>{{form.sub_time}}</td>
            <td>{{form.order_num}}</td>
            <td>{{form.order_detail}}</td>
            <td>{{form.ps}}</td>
            <td></td>
            <td></td>
            <td>{{form.person_incharge}}</td>
            <td><input type="submit"></td>
        </tr>
    </form>
</table>
</div>
{% endblock %}